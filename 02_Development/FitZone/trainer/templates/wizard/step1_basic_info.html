{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
.wizard-container {
  max-width: 900px;
  margin: 80px auto 40px;
  padding: 0 20px;
}

.wizard-progress {
  display: flex;
  justify-content: space-between;
  margin-bottom: 50px;
  position: relative;
}

.wizard-progress::before {
  content: '';
  position: absolute;
  top: 20px;
  left: 10%;
  width: 80%;
  height: 3px;
  background: rgba(0,0,0,0.1);
  z-index: 0;
}

.progress-step {
  flex: 1;
  text-align: center;
  position: relative;
  z-index: 1;
}

.step-circle {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: rgba(0,0,0,0.05);
  border: 2px solid rgba(0,0,0,0.1);
  margin: 0 auto 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: rgba(0,0,0,0.5);
  transition: all 0.3s ease;
}

.progress-step.active .step-circle {
  background: linear-gradient(135deg, #ff7a18, #ff9a3c);
  border-color: #ff7a18;
  color: #fff;
  font-weight: 900;
  box-shadow: 0 8px 25px rgba(255,122,24,0.4);
}

.progress-step.completed .step-circle {
  background: rgba(34,197,94,0.15);
  border-color: #22c55e;
  color: #22c55e;
}

.step-label {
  font-size: 14px;
  color: rgba(0,0,0,0.6);
  font-weight: 600;
}

.progress-step.active .step-label {
  color: #ff7a18;
}

.wizard-card {
  background: linear-gradient(135deg, rgba(255,255,255,0.97), rgba(248,249,250,0.97));
  border-radius: 20px;
  padding: 40px;
  border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0 25px 60px rgba(0,0,0,0.08);
}

.wizard-header {
  text-align: center;
  margin-bottom: 40px;
}

.wizard-header h2 {
  color: #1a1a1a;
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 10px;
}

.wizard-header p {
  color: rgba(0,0,0,0.7);
  font-size: 16px;
}

.form-group {
  margin-bottom: 25px;
}

.form-group label {
  display: block;
  color: #1a1a1a;
  font-weight: 600;
  margin-bottom: 8px;
}

.form-input, .form-textarea {
  width: 100%;
  padding: 14px 18px;
  background: rgba(0,0,0,0.03);
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 10px;
  color: #1a1a1a;
  font-size: 15px;
  transition: all 0.3s ease;
}

.form-input:focus, .form-textarea:focus {
  outline: none;
  border-color: #ff7a18;
  background: rgba(255,122,24,0.08);
  box-shadow: 0 0 0 3px rgba(255,122,24,0.15);
}

/* Tag Selection Styles */
.tags-container {
  margin-top: 12px;
}

.tags-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
}

.tag-item {
  display: inline-block;
}

.tag-item input[type="checkbox"] {
  display: none;
}

.tag-label {
  display: inline-block;
  padding: 10px 18px;
  background: rgba(0,0,0,0.03);
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 20px;
  color: rgba(0,0,0,0.7);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  user-select: none;
}

.tag-label:hover {
  background: rgba(0,0,0,0.05);
  border-color: rgba(0,0,0,0.2);
  transform: translateY(-1px);
}

.tag-item input[type="checkbox"]:checked + .tag-label {
  background: linear-gradient(135deg, #ff7a18, #ff9a3c);
  border-color: #ff7a18;
  color: #fff;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(255,122,24,0.3);
}

.tags-header {
  font-size: 13px;
  color: rgba(0,0,0,0.6);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.selection-counter {
  display: inline-block;
  margin-left: 10px;
  padding: 4px 12px;
  background: rgba(34,197,94,0.15);
  border: 1px solid rgba(34,197,94,0.3);
  border-radius: 12px;
  color: #22c55e;
  font-size: 12px;
  font-weight: 700;
}

.price-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.price-symbol {
  position: absolute;
  left: 18px;
  color: #ff7a18;
  font-weight: 700;
  font-size: 16px;
  pointer-events: none;
}

.price-input-wrapper .form-input {
  padding-left: 40px;
}

/* Availability Schedule Styles */
.availability-container {
  margin-top: 15px;
  padding: 25px;
  background: linear-gradient(135deg, rgba(255,122,24,0.03), rgba(255,154,60,0.02));
  border-radius: 12px;
  border: 1.5px solid rgba(255,122,24,0.15);
}

.day-range-selector {
  display: flex;
  align-items: flex-end;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.day-dropdown-group {
  flex: 1;
  min-width: 220px;
}

.day-dropdown-group select {
  width: 100%;
  padding: 14px 18px;
  background: rgba(255,255,255,0.97);
  border: 1.5px solid rgba(0,0,0,0.15);
  border-radius: 10px;
  color: #1a1a1a;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ff7a18' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 18px center;
  padding-right: 45px;
}

.day-dropdown-group select option {
  background: #ffffff !important;
  color: #1a1a1a;
  padding: 12px;
  font-weight: 600;
}

.day-dropdown-group select option:hover,
.day-dropdown-group select option:checked,
.day-dropdown-group select option:focus {
  background: linear-gradient(135deg, rgba(255,122,24,0.2), rgba(255,154,60,0.15)) !important;
  color: #ff7a18;
}

.day-dropdown-group select option:first-child {
  background: #ffffff !important;
  color: rgba(0,0,0,0.5);
  font-style: italic;
}

.day-dropdown-group select:hover {
  border-color: #ff7a18;
  background-color: rgba(255,122,24,0.08);
}

.day-dropdown-group select:focus {
  outline: none;
  border-color: #ff7a18;
  background-color: rgba(255,122,24,0.1);
  box-shadow: 0 0 0 3px rgba(255,122,24,0.15);
}

.dropdown-label {
  display: block;
  color: #1a1a1a;
  font-weight: 700;
  margin-bottom: 10px;
  font-size: 14px;
}

.dropdown-label i {
  color: #ff7a18;
  margin-right: 6px;
}

.range-arrow {
  color: #ff7a18;
  font-size: 28px;
  margin-bottom: 18px;
  font-weight: 700;
  text-shadow: 0 2px 8px rgba(255,122,24,0.3);
}

.time-slots-section {
  margin-top: 25px;
  padding-top: 25px;
  border-top: 1.5px solid rgba(0,0,0,0.08);
}

.time-slots-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
  margin-top: 15px;
}

.time-slot-tag {
  width: 100%;
  font-size: 14px !important;
  padding: 12px 16px !important;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.custom-time-input {
  margin-top: 20px;
  padding: 18px;
  background: rgba(0,0,0,0.02);
  border-radius: 10px;
  border: 1.5px dashed rgba(255,122,24,0.2);
}

.custom-time-label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  color: #ff7a18;
  font-weight: 700;
  font-size: 14px;
}

.custom-time-inputs {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.time-input-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.time-input-group label {
  font-size: 12px;
  color: rgba(0,0,0,0.7);
  font-weight: 600;
}

.time-input-group input {
  padding: 10px 14px;
  background: rgba(0,0,0,0.03);
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 8px;
  color: #1a1a1a;
  font-size: 14px;
  width: 120px;
  font-weight: 600;
}

.time-input-group input:focus {
  outline: none;
  border-color: #ff7a18;
  background: rgba(255,122,24,0.08);
  box-shadow: 0 0 0 3px rgba(255,122,24,0.15);
}

.add-custom-time-btn {
  padding: 10px 20px;
  background: linear-gradient(135deg, #ff7a18, #ff9a3c);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.add-custom-time-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255,122,24,0.3);
}

.custom-times-list {
  margin-top: 12px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.custom-time-pill {
  padding: 8px 14px;
  background: rgba(34,197,94,0.15);
  border: 1px solid rgba(34,197,94,0.3);
  border-radius: 20px;
  color: #22c55e;
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.custom-time-pill button {
  background: none;
  border: none;
  color: #ef4444;
  cursor: pointer;
  font-size: 16px;
  padding: 0;
  display: flex;
  align-items: center;
  transition: all 0.2s;
}

.custom-time-pill button:hover {
  transform: scale(1.2);
}

.help-text {
  font-size: 13px;
  color: rgba(0,0,0,0.5);
  margin-top: 6px;
}

.wizard-actions {
  display: flex;
  justify-content: space-between;
  gap: 15px;
  margin-top: 40px;
}

.btn-wizard {
  flex: 1;
  padding: 14px 28px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-next {
  background: linear-gradient(135deg, #ff7a18, #ff9a3c);
  color: #fff;
  box-shadow: 0 12px 30px rgba(255,122,24,0.25);
}

.btn-next:hover {
  transform: translateY(-2px);
  box-shadow: 0 16px 40px rgba(255,122,24,0.35);
}

.btn-back {
  background: rgba(0,0,0,0.05);
  color: rgba(0,0,0,0.85);
  border: 1.5px solid rgba(0,0,0,0.12);
}

.btn-back:hover {
  background: rgba(0,0,0,0.08);
  border-color: rgba(0,0,0,0.2);
}

.errorlist {
  list-style: none;
  padding: 0;
  margin: 8px 0;
}

.errorlist li {
  color: #fca5a5;
  font-size: 13px;
  background: rgba(239,68,68,0.15);
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid rgba(239,68,68,0.3);
}

.icon-accent { color: #ff7a18; }
.help-text-gap { margin-top: 12px; }
.help-text-gap-lg { margin-top: 15px; }
.range-arrow-inline { margin-bottom: 0; font-size: 20px; }
.btn-wizard-disabled { opacity: 0.5; cursor: not-allowed; }
</style>

<div class="wizard-container">
  <div class="wizard-progress">
    <div class="progress-step active">
      <div class="step-circle">
        <i class="fas fa-user"></i>
      </div>
      <div class="step-label">Basic Info</div>
    </div>
    <div class="progress-step">
      <div class="step-circle">
        <i class="fas fa-certificate"></i>
      </div>
      <div class="step-label">Certifications</div>
    </div>
    <div class="progress-step">
      <div class="step-circle">
        <i class="fas fa-file-shield"></i>
      </div>
      <div class="step-label">Documents</div>
    </div>
  </div>

  <div class="wizard-card">
    <div class="wizard-header">
      <h2><i class="fas fa-user icon-accent"></i> Basic Information</h2>
      <p>Tell us about your experience and expertise</p>
    </div>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {{ wizard.management_form }}

      <div class="form-group">
        <label for="{{ form.experience.id_for_label }}">Years of Experience *</label>
        {{ form.experience }}
        {% if form.experience.help_text %}
          <div class="help-text">{{ form.experience.help_text }}</div>
        {% endif %}
        {{ form.experience.errors }}
      </div>

      <div class="form-group">
        <label for="{{ form.specialization.id_for_label }}">
          Area of Expertise *
          <span class="selection-counter" id="spec-counter" style="display:none;"></span>
        </label>
        {{ form.specialization.errors }}
        <div class="tags-container">
          <div class="tags-header">
            <i class="fas fa-tags"></i> Select Your Specializations
          </div>
          <div class="tags-grid">
            {% for choice in form.specialization %}
              <div class="tag-item">
                {{ choice.tag }}
                <label for="{{ choice.id_for_label }}" class="tag-label">
                  {{ choice.choice_label }}
                </label>
              </div>
            {% endfor %}
          </div>
          <div class="help-text help-text-gap">
            <i class="fas fa-info-circle"></i> Click on tags to select your areas of expertise
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="{{ form.bio.id_for_label }}">Professional Bio</label>
        {{ form.bio }}
        {% if form.bio.help_text %}
          <div class="help-text">{{ form.bio.help_text }}</div>
        {% endif %}
        {{ form.bio.errors }}
      </div>

      <div class="form-group">
        <label for="{{ form.monthly_price.id_for_label }}">
          <i class="fas fa-rupee-sign"></i> Monthly Training Price (Rs)
        </label>
        <div class="price-input-wrapper">
          {{ form.monthly_price }}
        </div>
        {% if form.monthly_price.help_text %}
          <div class="help-text">{{ form.monthly_price.help_text }}</div>
        {% endif %}
        {{ form.monthly_price.errors }}
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-clock"></i> Availability Schedule
        </label>
        
        <div class="availability-container">
          <div class="day-range-selector">
            <div class="day-dropdown-group">
              <label for="{{ form.available_days_from.id_for_label }}" class="dropdown-label">
                <i class="fas fa-calendar-alt"></i> From Day
              </label>
              {{ form.available_days_from }}
              {{ form.available_days_from.errors }}
            </div>
            
            <div class="range-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
            
            <div class="day-dropdown-group">
              <label for="{{ form.available_days_to.id_for_label }}" class="dropdown-label">
                <i class="fas fa-calendar-check"></i> To Day
              </label>
              {{ form.available_days_to }}
              {{ form.available_days_to.errors }}
            </div>
          </div>
          
          <div class="time-slots-section">
            <label class="dropdown-label">
              <i class="fas fa-clock"></i> Select Time Slots
              <span class="selection-counter" id="time-counter" style="display:none;"></span>
            </label>
            {{ form.available_time_slots.errors }}
            <div class="time-slots-grid">
              {% for choice in form.available_time_slots %}
                <div class="tag-item">
                  {{ choice.tag }}
                  <label for="{{ choice.id_for_label }}" class="tag-label time-slot-tag">
                    <i class="fas fa-clock"></i> {{ choice.choice_label }}
                  </label>
                </div>
              {% endfor %}
            </div>
          </div>
          
          <div class="custom-time-input">
            <div class="custom-time-label">
              <i class="fas fa-plus-circle"></i>
              <span>Or Add Custom Time</span>
            </div>
            <div class="custom-time-inputs">
              <div class="time-input-group">
                <label>From</label>
                <input type="time" id="custom-time-from" class="custom-time-field">
              </div>
              <div class="range-arrow range-arrow-inline">
                <i class="fas fa-arrow-right"></i>
              </div>
              <div class="time-input-group">
                <label>To</label>
                <input type="time" id="custom-time-to" class="custom-time-field">
              </div>
              <button type="button" class="add-custom-time-btn" onclick="addCustomTime()">
                <i class="fas fa-plus"></i> Add Time
              </button>
            </div>
            <div class="custom-times-list" id="custom-times-list"></div>
            <input type="hidden" id="custom-times-hidden" name="custom_times" value="">
          </div>
          
          <div class="help-text help-text-gap-lg">
            <i class="fas fa-info-circle"></i> Select preset time slots or add your own custom availability times
          </div>
        </div>
      </div>

      <div class="wizard-actions">
        <button type="submit" name="wizard_goto_step" value="{{ wizard.steps.prev }}" class="btn-wizard btn-back btn-wizard-disabled" disabled>
          <i class="fas fa-arrow-left"></i> Previous
        </button>
        <button type="submit" class="btn-wizard btn-next">
          Next <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// Custom time management
let customTimes = [];

function addCustomTime() {
  const fromTime = document.getElementById('custom-time-from').value;
  const toTime = document.getElementById('custom-time-to').value;
  
  if (!fromTime || !toTime) {
    alert('Please select both start and end time');
    return;
  }
  
  if (fromTime >= toTime) {
    alert('End time must be after start time');
    return;
  }
  
  // Convert 24hr to 12hr format
  const formatTime = (time) => {
    const [hours, minutes] = time.split(':');
    const hour = parseInt(hours);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const displayHour = hour % 12 || 12;
    return `${displayHour}:${minutes} ${ampm}`;
  };
  
  const timeSlot = {
    from: fromTime,
    to: toTime,
    display: `${formatTime(fromTime)} - ${formatTime(toTime)}`
  };
  
  customTimes.push(timeSlot);
  renderCustomTimes();
  
  // Clear inputs
  document.getElementById('custom-time-from').value = '';
  document.getElementById('custom-time-to').value = '';
}

function removeCustomTime(index) {
  customTimes.splice(index, 1);
  renderCustomTimes();
}

function renderCustomTimes() {
  const container = document.getElementById('custom-times-list');
  const hiddenInput = document.getElementById('custom-times-hidden');
  
  if (customTimes.length === 0) {
    container.innerHTML = '';
    hiddenInput.value = '';
    return;
  }
  
  container.innerHTML = customTimes.map((time, index) => `
    <div class="custom-time-pill">
      <i class="fas fa-clock"></i>
      <span>${time.display}</span>
      <button type="button" onclick="removeCustomTime(${index})">
        <i class="fas fa-times-circle"></i>
      </button>
    </div>
  `).join('');
  
  // Store in hidden field
  hiddenInput.value = JSON.stringify(customTimes);
}

// Tag selection counter for specialization
const updateSpecializationCounter = () => {
  const checkboxes = document.querySelectorAll('#id_basic_info-specialization input[type="checkbox"]');
  const counter = document.getElementById('spec-counter');
  const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
  
  if (selectedCount > 0) {
    counter.textContent = `${selectedCount} selected`;
    counter.style.display = 'inline-block';
  } else {
    counter.style.display = 'none';
  }
};

// Tag selection counter for available time slots
const updateTimeCounter = () => {
  const checkboxes = document.querySelectorAll('#id_basic_info-available_time_slots input[type="checkbox"]');
  const counter = document.getElementById('time-counter');
  const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
  
  if (selectedCount > 0) {
    counter.textContent = `${selectedCount} selected`;
    counter.style.display = 'inline-block';
  } else {
    counter.style.display = 'none';
  }
};

// Add change listeners to specialization checkboxes
document.querySelectorAll('#id_basic_info-specialization input[type="checkbox"]').forEach(checkbox => {
  checkbox.addEventListener('change', updateSpecializationCounter);
});

// Add change listeners to time slot checkboxes
document.querySelectorAll('#id_basic_info-available_time_slots input[type="checkbox"]').forEach(checkbox => {
  checkbox.addEventListener('change', updateTimeCounter);
});

// Initial counts
updateSpecializationCounter();
updateTimeCounter();
</script>

{% endblock content %}
