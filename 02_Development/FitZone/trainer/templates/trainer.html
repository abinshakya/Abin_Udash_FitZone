{% extends 'base.html' %}
{% block content %}

<div class="container py-5 trainer-page trainer-page-wrap">

  <!-- Section Title -->
  <div class="trainer-section-title">
    <h2 class="mt-4">Meet Your <span>Trainers</span></h2>
    <p class="text-secondary">
      Our certified professionals are ready to guide you on your fitness journey.
    </p>
  </div>

  <!-- Trainer Cards -->
  <div class="row g-4 mt-3">
    {% if trainers %}
      {% for trainer in trainers %}
      <div class="col-12 col-md-6 col-lg-4">
        <article class="trainer-card-v2">

          <!-- Image -->
          <div class="trainer-media">
            {% if trainer.get_profile_picture %}
              <img
                src="{{ trainer.get_profile_picture.file.url }}"
                alt="{{ trainer.user.get_full_name|default:trainer.user.username }}"
                class="trainer-img-v2"
                onerror="this.src='https://ui-avatars.com/api/?name={{ trainer.user.get_full_name|default:trainer.user.username }}&size=600&background=ff7a18&color=fff'"
              >
            {% else %}
              <img
                src="https://ui-avatars.com/api/?name={{ trainer.user.get_full_name|default:trainer.user.username }}&size=600&background=ff7a18&color=fff"
                alt="{{ trainer.user.get_full_name|default:trainer.user.username }}"
                class="trainer-img-v2"
              >
            {% endif %}

            <!-- Top badges -->
            <div class="trainer-badges">
              <span class="badge-pill badge-verified">
                <span class="dot"></span> Verified
              </span>
              <span class="badge-pill badge-role">
                {{ trainer.specialization|default:"Trainer" }}
              </span>
            </div>

            <!-- Bottom overlay info -->
            <div class="trainer-overlay">
              <h3 class="trainer-name-v2">
                {{ trainer.user.get_full_name|default:trainer.user.username }}
              </h3>

              <div class="trainer-meta">
                <span class="meta-item">⭐ 5.0</span>
                <span class="meta-sep">•</span>
                <span class="meta-item">{{ trainer.experience|default:"0" }} yrs exp</span>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="trainer-content-v2">
            <p class="trainer-bio-v2">
              {{ trainer.bio|default:"Certified fitness professional dedicated to helping you achieve your health and wellness goals through personalized training programs." }}
            </p>

            <div class="trainer-actions">
              <a class="btn-outline-v2" href="{% url 'trainer_profile_detail' trainer.id %}">
                View Profile
              </a>

              <button class="btn-book-v2" type="button" data-bs-toggle="modal" data-bs-target="#bookingModal{{ trainer.id }}">
                Book Now
              </button>
            </div>
          </div>

        </article>

        <!-- Booking Modal -->
        <div class="modal fade" id="bookingModal{{ trainer.id }}" tabindex="-1" aria-labelledby="bookingModalLabel{{ trainer.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content booking-modal-content">
                    <form method="post" action="{% url 'book_trainer' trainer.id %}">
                        {% csrf_token %}
                        <!-- Hero Header -->
                        <div class="booking-modal-hero">
                            <div class="booking-hero-accent"></div>
                            <button type="button" class="btn-close booking-close-btn" data-bs-dismiss="modal" aria-label="Close"></button>
                            <div class="booking-avatar">
                                {{ trainer.user.get_full_name|default:trainer.user.username|make_list|first|upper }}
                            </div>
                            <h5 class="booking-modal-title">
                                Book Training Session
                            </h5>
                            <p class="booking-modal-subtitle">
                                with <span class="booking-trainer-name">{{ trainer.user.get_full_name|default:trainer.user.username }}</span>
                            </p>
                        </div>

                        <div class="modal-body booking-body">
                            <!-- Pricing & Time Row -->
                            <div class="booking-info-grid">
                                <div class="booking-info-card orange">
                                    <div class="booking-info-icon orange"><i class="fas fa-tags"></i></div>
                                    <div class="booking-info-label">Price</div>
                                    <div class="booking-info-value">
                                        {% if trainer.monthly_price %}₹{{ trainer.monthly_price }}<span class="booking-price-suffix">/mo</span>{% else %}TBD{% endif %}
                                    </div>
                                </div>
                                <div class="booking-info-card green">
                                    <div class="booking-info-icon green"><i class="fas fa-clock"></i></div>
                                    <div class="booking-info-label">Availability</div>
                                    <div class="booking-avail-value">
                                        {{ trainer.available_time|default:"Flexible" }}
                                    </div>
                                </div>
                            </div>

                            <!-- Date Picker -->
                            <div class="booking-field-group">
                                <label class="booking-field-label">
                                    <span class="booking-label-icon purple"><i class="fas fa-calendar-alt"></i></span>
                                    Preferred Start Date <span class="booking-required">*</span>
                                </label>
                                <input type="date" name="booking_date" required min="{{ today }}" class="booking-input">
                            </div>

                            <!-- Message -->
                            <div class="booking-field-group">
                                <label class="booking-field-label">
                                    <span class="booking-label-icon pink"><i class="fas fa-pen-fancy"></i></span>
                                    Message <span class="booking-optional">(optional)</span>
                                </label>
                                <textarea name="message" rows="3" placeholder="Tell the trainer about your fitness goals, preferred workout style..." class="booking-textarea"></textarea>
                            </div>

                            <!-- Warnings -->
                            {% if trainer.id in pending_booking_trainer_ids %}
                            <div class="booking-warning warn">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>You already have a pending booking with this trainer.</span>
                            </div>
                            {% endif %}
                            {% if user.is_authenticated and not user_is_email_verified %}
                            <div class="booking-warning danger">
                                <i class="fas fa-shield-alt"></i>
                                <span>Please verify your email before booking.</span>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Footer -->
                        <div class="booking-footer">
                            <button type="button" class="btn booking-cancel-btn" data-bs-dismiss="modal">Cancel</button>
                            {% if user.is_authenticated and user_is_email_verified and trainer.id not in pending_booking_trainer_ids %}
                                <button type="submit" class="btn booking-submit-btn">
                                    <i class="fas fa-bolt me-1"></i> Confirm Booking
                                </button>
                            {% elif not user.is_authenticated %}
                                <a href="{% url 'login' %}" class="btn booking-login-btn">
                                    <i class="fas fa-sign-in-alt me-1"></i> Login to Book
                                </a>
                            {% else %}
                                <button type="button" class="btn booking-disabled-btn" disabled>
                                    <i class="fas fa-lock me-1"></i> Cannot Book
                                </button>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>
        </div>

      </div>

      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="empty-state-v2 text-center py-5">
          <i class="fa-solid fa-user-slash empty-icon"></i>
          <h3>No Verified Trainers Available</h3>
          <p>Check back later for available trainers.</p>
        </div>
      </div>
    {% endif %}
  </div>

</div>

{% endblock content %}
