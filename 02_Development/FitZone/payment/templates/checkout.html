{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitZone | Checkout</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>:root{
  --bg0:#0b0b0c;
  --bg1:#141416;

  --cardTop: rgba(30,30,30,0.92);
  --cardBot: rgba(14,14,14,0.92);

  --text:#f4f4f4;
  --muted: rgba(255,255,255,0.68);
  --border: rgba(255,255,255,0.10);

  --orange:#ff7a18;
  --orange2:#ff9a3c;

  --shadow: 0 22px 70px rgba(0,0,0,0.65);
  --shadowSoft: 0 16px 45px rgba(0,0,0,0.45);
}

*{ box-sizing: border-box; }

body{
  margin: 0;
  font-family: "Poppins", system-ui, sans-serif;
  color: var(--text);
  background:
    radial-gradient(1000px 520px at 18% 0%, rgba(255,122,24,0.22), transparent 60%),
    radial-gradient(900px 450px at 85% 10%, rgba(255,154,60,0.12), transparent 60%),
    linear-gradient(135deg, var(--bg0) 0%, var(--bg1) 100%);
  min-height: 100vh;
}

.page{ padding: 36px 0 90px; }

.checkout-container{
  max-width: 1120px;
  margin: 0 auto;
  padding: 0 22px;
}

/* HEADER */
.page-head{
  text-align: center;
  margin: 8px 0 34px;
}

.page-head h1{
  margin: 0 0 10px;
  font-size: clamp(2.05rem, 3vw, 2.7rem);
  font-weight: 900;
  letter-spacing: 0.3px;
  background: linear-gradient(135deg, #ffffff, var(--orange2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 12px 40px rgba(255,122,24,0.10);
}

.page-head p{
  margin: 0;
  color: rgba(255,255,255,0.72);
  font-size: 1.05rem;
}

/* GRID */
.checkout-grid{
  display: grid;
  grid-template-columns: 1.15fr 0.85fr;
  gap: 22px;
  align-items: start;
}

@media (max-width: 900px){
  .checkout-grid{ grid-template-columns: 1fr; }
}

/* CARD */
.card{
  position: relative;
  background: linear-gradient(180deg, var(--cardTop), var(--cardBot));
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 22px;
  overflow: hidden;
  box-shadow: var(--shadowSoft);
}

/* subtle glow border */
.card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: 22px;
  padding: 1px;
  background: linear-gradient(135deg,
    rgba(255,122,24,0.22),
    rgba(255,255,255,0.08),
    rgba(255,154,60,0.18)
  );
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
          mask-composite: exclude;
  pointer-events:none;
  opacity: 0.75;
}

.card-header{
  padding: 18px 22px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  background: rgba(255,255,255,0.02);
}

.card-header h2,
.card-header h3{
  margin: 0;
  font-size: 1.12rem;
  font-weight: 900;
  letter-spacing: 0.2px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: rgba(255,255,255,0.92);
}

.card-body{ padding: 22px; }

/* PLAN DETAILS */
.plan-top{
  display: grid;
  grid-template-columns: 150px 1fr;
  gap: 18px;
  align-items: center;
  margin-bottom: 16px;
}

@media (max-width: 520px){
  .plan-top{ grid-template-columns: 1fr; }
}

.plan-img{
  width: 100%;
  height: 112px;
  border-radius: 16px;
  object-fit: cover;
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 18px 40px rgba(0,0,0,0.35);
}

.plan-title{
  margin: 0 0 8px;
  font-size: 1.55rem;
  font-weight: 900;
  color: #fff;
}

.plan-meta{
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}

.pill{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(255,122,24,0.14);
  border: 1px solid rgba(255,122,24,0.28);
  color: #fff;
  font-size: 0.9rem;
  font-weight: 900;
  white-space: nowrap;
}

.price{
  font-size: 2.15rem;
  font-weight: 900;
  color: var(--orange);
  letter-spacing: 0.3px;
  text-shadow: 0 10px 30px rgba(255,122,24,0.12);
}

.features-title{
  margin: 18px 0 12px;
  font-size: 1.05rem;
  font-weight: 900;
  color: rgba(255,255,255,0.90);
}

.plan-features{
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: 10px;
}

.plan-features li{
  display: flex;
  gap: 10px;
  align-items: flex-start;
  color: rgba(255,255,255,0.86);
  line-height: 1.35;
}

.plan-features i{
  color: var(--orange);
  margin-top: 3px;
}

/* SUMMARY */
.summary-row{
  display: flex;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 0;
  color: rgba(255,255,255,0.86);
}

.summary-row span:first-child{
  color: rgba(255,255,255,0.62);
  font-weight: 600;
}

.divider{
  height: 1px;
  background: rgba(255,255,255,0.08);
  margin: 12px 0;
}

.total{
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 12px;
  padding: 6px 0 2px;
}

.total .label{
  font-weight: 900;
  color: rgba(255,255,255,0.86);
}

.total .value{
  font-size: 1.85rem;
  font-weight: 950;
  color: var(--orange);
}

/* CUSTOMER INFO */
.customer{
  display: grid;
  gap: 12px;
  margin-top: 10px;
}

.info{
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 12px 14px;
  border-radius: 14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.09);
  color: rgba(255,255,255,0.86);
  font-weight: 700;
}

.info i{ color: var(--orange); }

.info .text{
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* PAYMENT METHOD */
.pm-title{
  margin: 18px 0 10px;
  font-size: 1.05rem;
  font-weight: 950;
  color: rgba(255,255,255,0.88);
  display: flex;
  align-items: center;
  gap: 10px;
}

.pm-grid{
  display: grid;
  gap: 12px;
  margin-top: 6px;
}

.pm-option{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.035);
  border: 1px solid rgba(255,255,255,0.10);
  cursor: pointer;
  transition: transform .2s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
  user-select: none;
}

.pm-option:hover{
  transform: translateY(-2px);
  background: rgba(255,255,255,0.055);
  border-color: rgba(255,122,24,0.30);
  box-shadow: 0 16px 32px rgba(0,0,0,0.25);
}

.pm-left{
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
}

.pm-radio{
  width: 18px;
  height: 18px;
  border-radius: 999px;
  border: 2px solid rgba(255,255,255,0.35);
  display: grid;
  place-items: center;
  flex: 0 0 auto;
}

.pm-radio::after{
  content: "";
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: transparent;
  transform: scale(0.6);
  transition: background .15s ease, transform .15s ease;
}

.pm-name{
  font-weight: 950;
  color: rgba(255,255,255,0.92);
}

.pm-badge{
  margin-left: 10px;
  font-size: 0.78rem;
  font-weight: 950;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,122,24,0.14);
  border: 1px solid rgba(255,122,24,0.22);
  color: #fff;
}

.pm-note{
  font-size: 0.85rem;
  color: rgba(255,255,255,0.60);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.pm-option input{
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

/* stronger selected state */
.pm-option:has(input:checked){
  border-color: rgba(255,122,24,0.55);
  background: rgba(255,122,24,0.08);
  box-shadow: 0 18px 40px rgba(255,122,24,0.10);
}

.pm-option:has(input:checked) .pm-radio{
  border-color: rgba(255,122,24,0.92);
}

.pm-option:has(input:checked) .pm-radio::after{
  background: linear-gradient(135deg, var(--orange), var(--orange2));
  transform: scale(1);
}

/* BUTTON */
.btn-pay{
  width: 100%;
  padding: 16px 18px;
  border-radius: 18px;
  font-size: 1.05rem;
  font-weight: 950;
  letter-spacing: 0.2px;
  color: #fff;
  background: linear-gradient(135deg, var(--orange), var(--orange2));
  border: 1px solid rgba(255,122,24,0.35);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: transform .25s ease, box-shadow .25s ease, filter .25s ease;
  margin-top: 18px;
}

.btn-pay:hover{
  transform: translateY(-3px);
  box-shadow: 0 22px 55px rgba(255,122,24,0.35);
  filter: brightness(1.08);
}

.note{
  margin-top: 12px;
  color: rgba(255,255,255,0.60);
  font-size: 0.92rem;
  line-height: 1.4;
}

.empty{
  text-align: center;
  color: var(--muted);
  padding: 30px 0;
}

/* ✅ :has() fallback */
@supports not(selector(:has(*))){
  .pm-option input:checked ~ .pm-fallback { display: none; }
}

  .icon-accent { color: var(--orange); }
  .min-w-0 { min-width: 0; }
  .icon-muted { color: rgba(255,255,255,0.7); }

  </style>
</head>

<body>
  {% include 'navbar.html' %}

  <main class="page">
    <div class="checkout-container">
      <header class="page-head">
        <h1>Checkout</h1>
        <p>Review your plan and complete your purchase securely.</p>
      </header>

      {% if plan %}
      <section class="checkout-grid">

        <!-- LEFT: PLAN DETAILS -->
        <div class="card">
          <div class="card-header">
            <h2>
              <i class="fa-solid fa-dumbbell icon-accent"></i>
              Plan Details
            </h2>
            <span class="pill"><i class="fa-solid fa-shield-halved"></i> Secure Checkout</span>
          </div>

          <div class="card-body">
            <div class="plan-top">
              {% if plan.image %}
                <img src="{{ plan.image.url }}" alt="{{ plan.name }}" class="plan-img">
              {% else %}
                <img src="{% static 'images/default-membership.png' %}" alt="Membership" class="plan-img">
              {% endif %}

              <div>
                <h3 class="plan-title">{{ plan.name }}</h3>
                <div class="plan-meta">
                  <div class="price">Rs{{ plan.price }}</div>
                  <div class="pill"><i class="fa-regular fa-clock"></i> {{ plan.get_duration_display }}</div>
                </div>
              </div>
            </div>

            <h4 class="features-title">What you’ll get</h4>
            <ul class="plan-features">
              <li><i class="fa-solid fa-check"></i> {{ plan.feature_1 }}</li>
              <li><i class="fa-solid fa-check"></i> {{ plan.feature_2 }}</li>
              {% if plan.feature_3 %}
                <li><i class="fa-solid fa-check"></i> {{ plan.feature_3 }}</li>
              {% endif %}
            </ul>
          </div>
        </div>

        <!-- RIGHT: ORDER SUMMARY + PAYMENT METHOD + PAY -->
        <div class="card">
          <div class="card-header">
            <h3>
              <i class="fa-solid fa-receipt icon-accent"></i>
              Order Summary
            </h3>
          </div>

          <div class="card-body">
            <div class="summary-row">
              <span>Plan</span>
              <strong>{{ plan.name }}</strong>
            </div>

            <div class="summary-row">
              <span>Duration</span>
              <strong>{{ plan.get_duration_display }}</strong>
            </div>

            <div class="summary-row">
              <span>Price</span>
              <strong>Rs {{ plan.price }}</strong>
            </div>

            <div class="divider"></div>

            <div class="total">
              <div class="label">Total</div>
              <div class="value"> Rs {{ plan.price }}</div>
            </div>

            <div class="divider"></div>

            <div class="customer">
              <div class="info">
                <i class="fa-solid fa-user"></i>
                <div class="text">{{ user.username }}</div>
              </div>
              <div class="info">
                <i class="fa-solid fa-envelope"></i>
                <div class="text">{{ user.email }}</div>
              </div>
            </div>

            <!--Payment Method -->
            <div class="pm-title">
              <i class="fa-solid fa-credit-card icon-accent"></i>
              Select Payment Method
            </div>

            <form action="{% url 'initiate_payment' plan.id %}" method="get">
              <div class="pm-grid">
                <label class="pm-option">
                  <input type="radio" name="payment_method" value="khalti" checked>
                  <div class="pm-left">
                    <div class="pm-radio"></div>
                    <div class="min-w-0">
                      <div class="pm-name">Khalti <span class="pm-badge">Popular</span></div>
                      <div class="pm-note">Pay using Khalti wallet</div>
                    </div>
                  </div>
                  <i class="fa-solid fa-wallet icon-muted"></i>
                </label>
              </div>

              <button type="submit" class="btn-pay">
                Pay NPR {{ plan.price }} Now <i class="fa-solid fa-arrow-right"></i>
              </button>
            </form>

            <p class="note">
              By clicking “Pay Now”, you agree to our terms and confirm your subscription purchase.
            </p>
          </div>
        </div>

      </section>
      {% else %}
        <p class="empty">Plan not found.</p>
      {% endif %}
    </div>
  </main>
</body>
</html>
